@model Order
@{
    ViewData["Title"] = "Detail";
}

<div class="container-fluid">
    <div class="book-cards">
        <div class="d-flex justify-content-between mb-3">
            <h1 class="text-dark mb-0">Order Detail Cards</h1>
        </div>
        <div class="row">
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-primary shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                    User Name
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-600">@Model.AppUser.FullName</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-user-circle fa-2x text-primary opasity-3"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-warning shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                    CreateAt
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-600">@Model.CreatedAt.ToString("HH:mm dd.MM.yyyy")</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-clock fa-2x text-warning opasity-3"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            @if (Model.Status != null)
            {
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card border-left-@(Model.Status==true? "success": "danger") shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-@(Model.Status==true? "success": "danger") text-uppercase mb-1">
                                        Status
                                    </div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-600">@(Model.Status==true? "Accepted": "Rejected")</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-@(Model.Status==true? "check-square text-success": "window-close text-danger")  fa-2x opasity-3"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
            <div class="col-xl-12 col-md-6 mb-4">
                <div class="card border-left-info shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                    FullAddress
                                </div>
                                <div class="h5 mb-0 text-gray-600">@Model.Country, @Model.City, @Model.State, @Model.Address</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-address-card fa-2x text-info opasity-3"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            @if (Model.Note != null)
            {
                <div class="col-xl-12 col-md-6 mb-4">
                    <div class="card border-left-dark shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-dark text-uppercase mb-1">
                                        User Note
                                    </div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-600">@Model.Note</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-address-card fa-2x text-dark opasity-3"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
            @if (Model.AdminNote != null)
            {
                <div class="col-xl-12 col-md-6 mb-4">
                    <div class="card border-left-primary shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                        User Note
                                    </div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-600">@Model.AdminNote</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-address-card fa-2x text-primary opasity-3"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
            <div class="col-xl-12 col-md-6 mb-4">
                <div class="card border-left-warning shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                    OrderItems
                                </div>
                                @foreach (var item in Model.OrderItems)
                                {
                                    <div class="h5 mb-0 font-weight-bold text-gray-600 d-flex justify-content-between">
                                        <div class="col-6 text-dark"><strong>@item.Book.Name</strong></div>
                                        <div class="col-2"> x @item.Count</div>
                                        <div class="col-2 text-right">@(item.Book.DiscountedPrice!=null? item.Book.DiscountedPrice:item.Book.Price)</div>
                                    </div>
                                    <hr />
                                }
                                <div class="h5 mb-0 font-weight-bold text-gray-600 d-flex justify-content-between">
                                    <div class="col-8 text-dark"><strong>TOTAL</strong></div>
                                    <div class="col-4 text-right">@(Model.TotalPrice.ToString("0.##"))</div>
                                </div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-clipboard-list fa-2x text-warning opasity-3"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    @if (Model.Status == null)
    {
        <div class="form">
            <form method="post">
                <div class="form-group">
                    <div class="form-row">
                        <div class="col-md-6">
                            <label for="note">Note</label>
                            <textarea class="form-control" name="note" id="note" rows="3"></textarea>
                            <span class="text-danger" id="note-error"></span>
                        </div>
                    </div>
                </div>
                <a asp-action="accept" asp-route-id="@Model.Id" class="btn btn-success btn-icon-split mb-2 w-25 d-flex justify-content-between order-accept">
                    <span class="icon" style="background: #05963f45;">
                        <i class="fas fa-check-circle" style="color: #ffffffb3;"></i>
                    </span>
                    <span class="text text-center w-100">Accept</span>
                </a>
                <a asp-action="reject" asp-route-id="@Model.Id" class="btn btn-danger btn-icon-split w-25 d-flex justify-content-between order-reject">
                    <span class="icon" style="background: #82240845;">
                        <i class="fas fa-times-circle" style="color: #ffffffb3;"></i>
                    </span>
                    <span class="text text-center w-100">Reject</span>
                </a>
            </form>
        </div>
    }
</div>

@section Scripts{ 
<script>
    $(document).ready(function () {
        $(document).on("click", ".order-accept", function (e) {
            e.preventDefault();

            var note = $("#note").val();
            var url = $(this).attr("href") + "?note=" + note;

            fetch(url).then(response => response.json())
                .then(data => {
                    window.location.reload(true);
                });

        });
        $(document).on("click", ".order-reject", function (e) {
            e.preventDefault();

            var note = $("#note").val();
            console.log("note= " + note);
            if (note == "") {
                console.log("bos");
                $("#note-error").text("Note is required!");
            } else {
                var url = $(this).attr("href") + "?note=" + note;
                console.log("url+note= " + url);

                fetch(url).then(response => response.json())
                    .then(data => {
                        if (data.status == 400) {
                            $("#note-error").text("Note is required 400!");
                        } else {
                            window.location.reload(true);
                        }
                    });  

                $("#note-error").empty();
            }
        });

    });
</script>
}